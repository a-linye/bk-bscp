syntax = "proto3";

import "pkg/protocol/core/base/base.proto";
import "pkg/protocol/core/process-instance/process_instance.proto";
import "pkg/protocol/core/task_batch/task_batch.proto";
import "google/protobuf/timestamp.proto";
import "protoc-gen-openapiv2/options/annotations.proto";

package pbproc;

option go_package = "github.com/TencentBlueKing/bk-bscp/pkg/protocol/core/process;pbproc";

// Process source resource reference: pkg/dal/table/process.go
message Process {
  uint32 id = 1 [(grpc.gateway.protoc_gen_openapiv2.options.openapiv2_field) = { description: "进程管理ID" }];
  ProcessSpec spec = 2;
  ProcessAttachment attachment = 3;
  pbbase.Revision revision = 4;
  repeated pbpi.ProcInst proc_inst = 5
      [(grpc.gateway.protoc_gen_openapiv2.options.openapiv2_field) = { description: "进程实例" }];
}

// ProcessSpec source resource reference: pkg/dal/table/process.go
message ProcessSpec {
  string set_name = 1 [(grpc.gateway.protoc_gen_openapiv2.options.openapiv2_field) = { description: "集群" }];
  string module_name = 2 [(grpc.gateway.protoc_gen_openapiv2.options.openapiv2_field) = { description: "模块" }];
  string service_name = 3
      [(grpc.gateway.protoc_gen_openapiv2.options.openapiv2_field) = { description: "服务实例名称" }];
  string environment = 4
      [(grpc.gateway.protoc_gen_openapiv2.options.openapiv2_field) = { description: "环境类型(production/staging等)" }];
  string alias = 5 [(grpc.gateway.protoc_gen_openapiv2.options.openapiv2_field) = { description: "进程别名" }];
  string inner_ip = 6 [(grpc.gateway.protoc_gen_openapiv2.options.openapiv2_field) = { description: "内网IP" }];
  string cc_sync_status = 7 [
    (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_field) = { description: "cc同步状态:synced,deleted,updated" }
  ];
  google.protobuf.Timestamp cc_sync_updated_at = 8
      [(grpc.gateway.protoc_gen_openapiv2.options.openapiv2_field) = { description: "cc同步更新时间" }];
  string source_data = 9
      [(grpc.gateway.protoc_gen_openapiv2.options.openapiv2_field) = { description: "本次同步的数据" }];
  string prev_data = 10
      [(grpc.gateway.protoc_gen_openapiv2.options.openapiv2_field) = { description: "上一次同步的数据" }];
  uint32 proc_num = 11 [(grpc.gateway.protoc_gen_openapiv2.options.openapiv2_field) = { description: "进程数量" }];
  // 展示操作按钮是否可以操作,是一个map，key代表动作，value代表是否可以操作
  map<string, bool> actions = 12 [(grpc.gateway.protoc_gen_openapiv2.options.openapiv2_field) = {
    description: "展示操作按钮是否可以操作(key可以是register,unregister,start,stop,restart,reload,kill)"
  }];
  string status = 13
      [(grpc.gateway.protoc_gen_openapiv2.options.openapiv2_field) = { description: "进程状态:running,stopped" }];
  string managed_status = 14
      [(grpc.gateway.protoc_gen_openapiv2.options.openapiv2_field) = { description: "托管状态:managed,unmanaged" }];
  repeated uint32 bind_template_ids = 15
      [(grpc.gateway.protoc_gen_openapiv2.options.openapiv2_field) = { description: "绑定模板ID" }];
  string process_config_view_url = 16
      [(grpc.gateway.protoc_gen_openapiv2.options.openapiv2_field) = { description: "查看进程配置的url" }];
}

message ProcessAttachment {
  uint32 biz_id = 1 [(grpc.gateway.protoc_gen_openapiv2.options.openapiv2_field) = { description: "业务ID" }];
  string tenant_id = 2 [(grpc.gateway.protoc_gen_openapiv2.options.openapiv2_field) = { description: "租户ID" }];
  uint32 cc_process_id = 3 [(grpc.gateway.protoc_gen_openapiv2.options.openapiv2_field) = { description: "cc进程ID" }];
  uint32 set_id = 4 [(grpc.gateway.protoc_gen_openapiv2.options.openapiv2_field) = { description: "集群ID" }];
  uint32 module_id = 5 [(grpc.gateway.protoc_gen_openapiv2.options.openapiv2_field) = { description: "模块ID" }];
  uint32 service_instance_id = 6
      [(grpc.gateway.protoc_gen_openapiv2.options.openapiv2_field) = { description: "服务实例ID" }];
  uint32 host_id = 7 [(grpc.gateway.protoc_gen_openapiv2.options.openapiv2_field) = { description: "主机ID" }];
  uint32 cloud_id = 8 [(grpc.gateway.protoc_gen_openapiv2.options.openapiv2_field) = { description: "cloud_id" }];
  string agent_id = 9 [(grpc.gateway.protoc_gen_openapiv2.options.openapiv2_field) = { description: "agent_id" }];
  uint32 process_template_id = 10
      [(grpc.gateway.protoc_gen_openapiv2.options.openapiv2_field) = { description: "进程模板ID" }];
}

// ProcessSearchCondition 进程搜索条件
message ProcessSearchCondition {
  repeated string sets = 1 [(grpc.gateway.protoc_gen_openapiv2.options.openapiv2_field) = { description: "集群名称" }];
  repeated string modules = 2
      [(grpc.gateway.protoc_gen_openapiv2.options.openapiv2_field) = { description: "模块名称" }];
  repeated string service_instances = 3
      [(grpc.gateway.protoc_gen_openapiv2.options.openapiv2_field) = { description: "服务名称" }];
  repeated uint32 cc_process_ids = 4
      [(grpc.gateway.protoc_gen_openapiv2.options.openapiv2_field) = { description: "进程ID" }];
  repeated string process_aliases = 5
      [(grpc.gateway.protoc_gen_openapiv2.options.openapiv2_field) = { description: "进程别名" }];
  repeated string inner_ips = 6
      [(grpc.gateway.protoc_gen_openapiv2.options.openapiv2_field) = { description: "内网IP" }];
  repeated string process_statuses = 7
      [(grpc.gateway.protoc_gen_openapiv2.options.openapiv2_field) = { description: "进程状态" }];
  repeated string managed_statuses = 8
      [(grpc.gateway.protoc_gen_openapiv2.options.openapiv2_field) = { description: "托管状态" }];
  repeated string cc_sync_statuses = 9
      [(grpc.gateway.protoc_gen_openapiv2.options.openapiv2_field) = { description: "cc同步状态" }];
  string environment = 10 [(grpc.gateway.protoc_gen_openapiv2.options.openapiv2_field) = { description: "环境" }];
  repeated uint32 process_template_ids = 11
      [(grpc.gateway.protoc_gen_openapiv2.options.openapiv2_field) = { description: "进程模板ID" }];
}

// ProcessFilterOption 进程过滤选项
message ProcessFilterOption {
  uint32 id = 1;
  string name = 2;
}

// FilterOptions 查询过滤选项
message FilterOptions {
  repeated pbtb.Choice inner_ips = 1
      [(grpc.gateway.protoc_gen_openapiv2.options.openapiv2_field) = { description: "内网IP" }];
  repeated pbtb.Choice process_statuses = 2
      [(grpc.gateway.protoc_gen_openapiv2.options.openapiv2_field) = { description: "进程状态" }];
  repeated pbtb.Choice managed_statuses = 3
      [(grpc.gateway.protoc_gen_openapiv2.options.openapiv2_field) = { description: "托管状态" }];
  repeated pbtb.Choice cc_sync_statuses = 4
      [(grpc.gateway.protoc_gen_openapiv2.options.openapiv2_field) = { description: "cc同步状态" }];
}